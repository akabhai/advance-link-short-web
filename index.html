<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure Link Shortener</title>
    <style>
        :root { --primary: #00f2ea; --bg: #0f172a; --card: #1e293b; --text: #e2e8f0; }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', sans-serif; }
        body { background: var(--bg); color: var(--text); display: flex; align-items: center; justify-content: center; min-height: 100vh; overflow: hidden; }
        .container { background: var(--card); padding: 2.5rem; border-radius: 16px; width: 90%; max-width: 450px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); text-align: center; border: 1px solid #334155; }
        h1 { margin-bottom: 1.5rem; font-size: 1.5rem; color: var(--primary); text-transform: uppercase; letter-spacing: 2px; }
        input { width: 100%; padding: 12px; margin-bottom: 1rem; border-radius: 8px; border: 1px solid #475569; background: #0f172a; color: white; outline: none; transition: 0.3s; }
        input:focus { border-color: var(--primary); box-shadow: 0 0 10px rgba(0, 242, 234, 0.2); }
        button { width: 100%; padding: 12px; background: linear-gradient(90deg, #00f2ea, #0080ff); border: none; border-radius: 8px; color: #000; font-weight: bold; cursor: pointer; transition: transform 0.2s; }
        button:active { transform: scale(0.98); }
        .result { margin-top: 1.5rem; padding: 1rem; background: #0f172a; border-radius: 8px; word-break: break-all; display: none; border: 1px solid #334155; font-size: 0.9rem; }
        .error { color: #ff4757; font-size: 0.85rem; margin-top: 0.5rem; display: none; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Link Encryptor</h1>
        <input type="url" id="urlInput" placeholder="https://example.com" autocomplete="off">
        <button onclick="generateLink()">SHORTEN & SECURE</button>
        <div class="error" id="errorMsg"></div>
        <div class="result" id="resultArea"></div>
    </div>

    <script>
        /* --- CONFIGURATION --- */
        // MUST MATCH IN ALL FILES
        const SECRET_SALT = "Xy9_#m2$Lp!5"; 
        const RESOLVER_PATH = "/go/"; // Path to the resolver folder
        
        /* --- SECURITY & LOGIC --- */
        async function sha256(message) {
            const msgBuffer = new TextEncoder().encode(message);
            const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
        }

       async function generateLink() {
            const input = document.getElementById('urlInput').value.trim();
            const errDiv = document.getElementById('errorMsg');
            const resDiv = document.getElementById('resultArea');
            
            errDiv.style.display = 'none';
            resDiv.style.display = 'none';

            if (!input.startsWith('http')) {
                errDiv.innerText = "Error: URL must start with http:// or https://";
                errDiv.style.display = 'block';
                return;
            }

            try {
                // 1. Convert URL to Base64
                const base64 = btoa(input);
                
                // 2. Hash the Base64 directly (FIXED)
                const signature = await sha256(base64 + SECRET_SALT);

                // 3. Create URL Safe string for the link
                const encodedData = encodeURIComponent(base64);

                const currentOrigin = window.location.origin + window.location.pathname.replace('index.html', '');
                // Ensure no double slash if path is empty
                const cleanPath = RESOLVER_PATH.startsWith('/') ? RESOLVER_PATH : '/' + RESOLVER_PATH;
                
                const finalLink = `${currentOrigin}${cleanPath}?d=${encodedData}&v=${signature}`;

                resDiv.innerHTML = `<strong>Secure Link Generated:</strong><br><br><a href="${finalLink}" style="color:#00f2ea" target="_blank">${finalLink}</a>`;
                resDiv.style.display = 'block';
            } catch (e) {
                console.error(e);
                errDiv.innerText = "Encryption failed. Browser not compatible.";
                errDiv.style.display = 'block';
            }
        }
    </script>
</body>
</html>
